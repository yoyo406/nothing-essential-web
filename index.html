<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Mémoire - Nano Banana</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#6750A4">

<style>
:root {
  --md-primary: #6750A4;
  --md-surface: #FFFBFE;
  --md-surface-variant: #E7E0EC;
  --md-on-surface: #1C1B1F;
  --md-outline-variant: #CAC4D0;
  --fluid-curve: cubic-bezier(0.34, 1.56, 0.64, 1);
  --glass: rgba(255, 251, 254, 0.8);
}

* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body { font-family: 'Inter', sans-serif; background: var(--md-surface); color: var(--md-on-surface); overflow-x: hidden; padding-bottom: 100px; }

/* ── ANIMATIONS ── */
@keyframes fluidUp { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
.fade-in { animation: fluidUp 0.5s var(--fluid-curve) both; }

/* ── HEADER & SEARCH ── */
.app-header {
  position: sticky; top: 0; z-index: 100;
  background: var(--glass); backdrop-filter: blur(20px);
  padding: 12px 20px; border-bottom: 1px solid var(--md-outline-variant);
}
.header-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }

/* ── SETTINGS DRAWER ── */
#settings-drawer {
  position: fixed; top: 0; right: 0; bottom: 0; width: 280px;
  background: var(--md-surface); z-index: 501;
  transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.2, 0, 0, 1);
  padding: 24px; box-shadow: -10px 0 30px rgba(0,0,0,0.1);
}
#settings-drawer.active { transform: translateX(0); }
.drawer-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.3);
  z-index: 500; display: none; backdrop-filter: blur(4px);
}

/* ── CARDS ── */
.cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; padding: 20px; }
.card {
  background: white; border-radius: 24px; padding: 20px; border: 1px solid var(--md-outline-variant);
  transition: all 0.3s var(--fluid-curve); cursor: pointer; position: relative;
}
.card:active { transform: scale(0.98); }

/* ── POPUPS & MODALS ── */
#choice-popup {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6);
  backdrop-filter: blur(8px); z-index: 1000;
  display: none; align-items: center; justify-content: center;
}
.choice-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
  width: 90%; max-width: 340px; animation: fluidUp 0.4s var(--fluid-curve);
}
.choice-card {
  aspect-ratio: 1/1; background: white; border-radius: 32px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 10px; cursor: pointer;
}

.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.5);
  z-index: 1100; display: none; align-items: flex-end;
}
.modal-overlay.active { display: flex; }
.modal-sheet {
  background: white; width: 100%; max-width: 600px; border-radius: 32px 32px 0 0;
  padding: 24px; margin: 0 auto; transform: translateY(100%);
  transition: transform 0.4s var(--fluid-curve);
}
.modal-overlay.active .modal-sheet { transform: translateY(0); }

input, textarea {
    width: 100%; padding: 14px; border-radius: 16px; 
    border: 1px solid var(--md-outline-variant); background: #f9f9f9;
    margin-bottom: 12px; outline: none; font-family: inherit;
}

.fab {
  position: fixed; bottom: 30px; right: 24px;
  background: #EADDFF; color: var(--md-primary);
  padding: 16px 24px; border-radius: 24px; display: flex; align-items: center; gap: 8px;
  font-weight: 700; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: pointer; z-index: 200;
}
</style>
</head>
<body>

<header class="app-header">
  <div class="header-top">
    <div style="font-family:'Nunito'; font-weight:800; font-size:24px; color:var(--md-primary)">Mémoire</div>
    <div style="display:flex; gap:10px;">
        <button onclick="toggleSettings(true)" style="background:none; border:none;"><span class="material-icons-round">settings</span></button>
        <div style="width:32px; height:32px; background:var(--md-primary); border-radius:50%; color:white; display:flex; align-items:center; justify-content:center; font-weight:700">NB</div>
    </div>
  </div>
  <div style="background:var(--md-surface-variant); padding:10px 16px; border-radius:14px; display:flex; align-items:center; gap:10px;">
    <span class="material-icons-round">search</span>
    <input type="text" placeholder="Rechercher..." style="background:none; border:none; margin-bottom:0; padding:0" oninput="search(this.value)">
  </div>
</header>

<div class="cards-grid" id="container"></div>

<div class="fab" onclick="toggleChoice(true)">
  <span class="material-icons-round">add</span> Nouveau
</div>

<div id="choice-popup" onclick="toggleChoice(false)">
  <div class="choice-grid" onclick="event.stopPropagation()">
    <div class="choice-card" onclick="openForm('note')">
      <span class="material-icons-round" style="color:#6750A4">edit_note</span>
      <span>TEXTE</span>
    </div>
    <div class="choice-card" onclick="openForm('image')">
      <span class="material-icons-round" style="color:#6750A4">image</span>
      <span>IMAGE</span>
    </div>
    <div class="choice-card" onclick="openForm('link')">
      <span class="material-icons-round" style="color:#6750A4">link</span>
      <span>LIEN</span>
    </div>
    <div class="choice-card" onclick="toggleChoice(false)">
      <span class="material-icons-round">close</span>
      <span>FERMER</span>
    </div>
  </div>
</div>

<div class="drawer-overlay" id="overlay" onclick="toggleSettings(false)"></div>
<div id="settings-drawer">
  <h2 style="font-family:'Nunito'; margin-bottom:24px">Paramètres</h2>
  <div onclick="exportData()" style="padding:16px; border-radius:16px; background:#F3EDF7; margin-bottom:12px; cursor:pointer; display:flex; gap:12px">
    <span class="material-icons-round">share</span> Exporter / Partager
  </div>
  <div onclick="localStorage.clear(); location.reload();" style="padding:16px; border-radius:16px; color:#ba1a1a; cursor:pointer; display:flex; gap:12px">
    <span class="material-icons-round">delete_sweep</span> Effacer tout
  </div>
</div>

<div class="modal-overlay" id="modal-overlay">
  <div class="modal-sheet">
    <h3 id="form-title" style="margin-bottom:20px; font-family:'Nunito'">Nouveau souvenir</h3>
    <input type="text" id="title" placeholder="Titre">
    <textarea id="content" placeholder="Contenu..." rows="4"></textarea>
    <button onclick="save()" style="width:100%; padding:16px; background:var(--md-primary); color:white; border:none; border-radius:100px; font-weight:700; font-size:16px">ENREGISTRER</button>
    <button onclick="closeForm()" style="width:100%; padding:12px; background:none; border:none; margin-top:8px; color:#666">Annuler</button>
  </div>
</div>

<script>
let items = JSON.parse(localStorage.getItem('notes_v2')) || [];
let currentType = 'note';

function toggleChoice(show) {
  document.getElementById('choice-popup').style.display = show ? 'flex' : 'none';
}

function toggleSettings(show) {
  document.getElementById('settings-drawer').classList.toggle('active', show);
  document.getElementById('overlay').style.display = show ? 'block' : 'none';
}

function openForm(type) {
  currentType = type;
  toggleChoice(false);
  document.getElementById('form-title').innerText = "Ajouter " + type;
  document.getElementById('title').value = "";
  document.getElementById('content').value = "";
  document.getElementById('modal-overlay').classList.add('active');
}

function closeForm() {
  document.getElementById('modal-overlay').classList.remove('active');
}

function save() {
  const title = document.getElementById('title').value.trim();
  const content = document.getElementById('content').value.trim();
  
  if(!title && !content) return alert("Note vide !");

  items.unshift({ 
    title: title || "Sans titre", 
    content: content, 
    type: currentType, 
    date: new Date().toLocaleDateString('fr-FR') 
  });
  
  localStorage.setItem('notes_v2', JSON.stringify(items));
  render();
  closeForm();
}

function render(data = items) {
  const container = document.getElementById('container');
  if(data.length === 0) {
      container.innerHTML = `<div style="text-align:center; grid-column:1/-1; padding:40px; opacity:0.5">Aucun souvenir ici.</div>`;
      return;
  }
  container.innerHTML = data.map((item, i) => `
    <div class="card fade-in" style="animation-delay: ${i * 0.05}s">
      <div style="font-size:10px; color:var(--md-primary); font-weight:800; text-transform:uppercase; margin-bottom:6px; letter-spacing:1px">${item.type}</div>
      <div style="font-family:'Nunito'; font-weight:700; font-size:17px">${item.title}</div>
      <div style="font-size:14px; color:#49454F; margin-top:8px; line-height:1.5">${item.content}</div>
      <div style="margin-top:16px; font-size:10px; opacity:0.4; font-weight:600">${item.date}</div>
    </div>
  `).join('');
}

function search(q) {
  const filtered = items.filter(i => 
    i.title.toLowerCase().includes(q.toLowerCase()) || 
    i.content.toLowerCase().includes(q.toLowerCase())
  );
  render(filtered);
}

// --- FONCTION EXPORT / PARTAGE CORRIGÉE ---
async function exportData() {
  toggleSettings(false);
  if (items.length === 0) return alert("Rien à exporter.");

  const dataStr = JSON.stringify(items, null, 2);

  // Tentative de partage natif (Mobile / Median.co)
  if (navigator.share) {
    try {
      const file = new File([dataStr], 'sauvegarde_memoire.json', { type: 'application/json' });
      await navigator.share({
        title: 'Ma Sauvegarde Mémoire',
        text: 'Voici mes notes sauvegardées.',
        files: [file]
      });
    } catch (err) {
      // Secours : partage de texte si le partage de fichier échoue
      navigator.share({
        title: 'Sauvegarde Mémoire',
        text: dataStr
      });
    }
  } else {
    // Secours PC : Téléchargement direct
    const blob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'sauvegarde_memoire.json';
    a.click();
    URL.revokeObjectURL(url);
  }
}

render();
</script>
</body>
</html>
